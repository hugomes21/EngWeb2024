extends layout

block content
  .w3-card-4 
    header.w3-container.w3-blue.w3-center
      h1 Adicionar Nova Rua

      a.w3-btn.w3-margin-top.w3-border.w3-round-large.w3-text-white(href='/ruas' style='background-color: #4CAF50;') Voltar à lista

    .w3-container
      form.w3-container(method="post", action="/criar", enctype="multipart/form-data")
        .w3-section
          label.w3-label(_for="_id") ID
          input.w3-input(type="text", name="_id", required)

        .w3-section
          label.w3-label(_for="numero") Número
          input.w3-input(type="text", name="numero", required)

        .w3-section
          label.w3-label(_for="nome") Nome
          input.w3-input(type="text", name="nome", required)

        .w3-section
          label.w3-label(_for="latitude") Latitude
          input.w3-input(type="text", name="latitude", required)

        .w3-section
          label.w3-label(_for="longitude") Longitude
          input.w3-input(type="text", name="longitude", required)

        // Seção para Entidades
        .w3-section
          label.w3-label Entidades
          .entidades-container
            .entidade
              input.w3-input(type="text", name="entidades[nome][]" placeholder="Nome da Entidade")
              select.w3-select(name="entidades[tipo][]")
                option(value="", disabled, selected) -- Selecione o Tipo --
                option(value="pessoa") Pessoa
                option(value="instituição") Instituição
                option(value="empresa") Empresa
                option(value="família") Família

          button.w3-button.w3-green(type="button", onclick="addEntidade()") Adicionar Entidade

        // Seção para Lugares
        .w3-section
          label.w3-label Lugares
          .lugares-container
            .lugar
              input.w3-input(type="text", name="lugares[nome][]" placeholder="Nome do Lugar")
              input.w3-input(type="text", name="lugares[norm][]" placeholder="Norm (opcional)")
          button.w3-button.w3-green(type="button", onclick="addLugar()") Adicionar Lugar

        // Seção para Datas
        .w3-section
          label.w3-label Datas
          .datas-container
            .data
              input.w3-input(type="text", name="datas[]" placeholder="Data")
          button.w3-button.w3-green(type="button", onclick="addData()") Adicionar Data

        .w3-section
          label.w3-label(_for="texto") Descrição
          textarea.w3-input(name="texto", required)

        .w3-section
          label.w3-label Casas
          .casas-container
            .casa
              input.w3-input(type="text", name="casas[numero][]" placeholder="Número da Casa")
              input.w3-input(type="text", name="casas[enfiteutas][]" placeholder="Enfiteutas")
              input.w3-input(type="text", name="casas[foro][]" placeholder="Foro")
              textarea.w3-input(name="casas[desc][texto][]" placeholder="Descrição")
              .refs-entidades-container
                label Entidades:
                .entidade
                  input.w3-input(type="text", name="casas[desc][refs][entidades][0][nome][]" placeholder="Nome da Entidade")
                  select.w3-select(name="casas[desc][refs][entidades][0][tipo][]")
                    option(value="", disabled, selected) -- Selecione o Tipo --
                    option(value="pessoa") Pessoa
                    option(value="instituição") Instituição
                    option(value="empresa") Empresa
                    option(value="família") Família

                button.w3-button.w3-green(type="button", onclick="addCasaEntidade(0, this)") Adicionar Entidade
              .refs-lugares-container
                label Lugares:
                .lugar
                  input.w3-input(type="text", name="casas[desc][refs][lugares][0][nome][]" placeholder="Nome do Lugar")
                  input.w3-input(type="text", name="casas[desc][refs][lugares][0][norm][]" placeholder="Norm (opcional)")
                button.w3-button.w3-green(type="button", onclick="addCasaLugar(0, this)") Adicionar Lugar
              .refs-datas-container
                label Datas:
                .data
                  input.w3-input(type="text", name="casas[desc][refs][datas][0][]" placeholder="Data")
                button.w3-button.w3-green(type="button", onclick="addCasaData(0, this)") Adicionar Data
          button.w3-button.w3-green(type="button", onclick="addCasa()") Adicionar Casa

        // Seção para Imagens
        .w3-section.imagem-section
          .imagem-item
            label.w3-label(_for="imagem") Imagem
            input.w3-input(type="file", name="imagem")
            label.w3-label(_for="legenda_imagem[0]") Legenda da Imagem
            input.w3-input(type="text", name="legenda_imagem[0]")

        button.w3-button.w3-green(type="button", onclick="addNovaImagem('imagem')") Adicionar Nova Imagem

        .w3-section.atual-section
          .imagem-item
            label.w3-label(_for="atual") Atual
            input.w3-input(type="file", name="atual")
            label.w3-label(_for="legenda_atual[0]") Legenda Atual
            input.w3-input(type="text", name="legenda_atual[0]")

        button.w3-button.w3-green(type="button", onclick="addNovaImagem('atual')") Adicionar Nova Vista Atual

        .w3-section
          button.w3-button.w3-blue(type="submit") Adicionar Rua

  script.
    let casaIndex = 0; // Contador de casas

    function addEntidade() {
      var container = document.querySelector('.entidades-container');
      var div = document.createElement('div');
      div.className = 'entidade';
      div.innerHTML = `
        <input class="w3-input" type="text" name="entidades[nome][]" placeholder="Nome da Entidade">
        <select class="w3-select" name="entidades[tipo][]">
          <option value="" disabled selected>-- Selecione o Tipo --</option>
          <option value="pessoa">Pessoa</option>
          <option value="instituição">Instituição</option>
          <option value="empresa">Empresa</option>
          <option value="família">Família</option>
        </select>
      `;
      container.appendChild(div);
    }

    function addLugar() {
      var container = document.querySelector('.lugares-container');
      var div = document.createElement('div');
      div.className = 'lugar';
      div.innerHTML = '<input class="w3-input" type="text" name="lugares[nome][]" placeholder="Nome do Lugar"><input class="w3-input" type="text" name="lugares[norm][]" placeholder="Norm (opcional)">';
      container.appendChild(div);
    }

    function addData() {
      var container = document.querySelector('.datas-container');
      var div = document.createElement('div');
      div.className = 'data';
      div.innerHTML = '<input class="w3-input" type="text" name="datas[]" placeholder="Data">';
      container.appendChild(div);
    }

    function addNovaImagem(tipo) {
      const section = tipo === 'imagem' ? document.querySelector('.imagem-section') : document.querySelector('.atual-section');
      const div = document.createElement('div');
      div.className = 'imagem-item';
      div.innerHTML = `
        <label class="w3-label" for="${tipo}">${tipo.charAt(0).toUpperCase() + tipo.slice(1)}</label>
        <input class="w3-input" type="file" name="${tipo}">
        <label class="w3-label" for="legenda_${tipo}">Legenda ${tipo.charAt(0).toUpperCase() + tipo.slice(1)}</label>
        <input class="w3-input" type="text" name="legenda_${tipo}[]">
      `;
      section.appendChild(div);
    }

    function addCasa() {
      casaIndex++;
      var container = document.querySelector('.casas-container');
      var div = document.createElement('div');
      div.className = 'casa';
      div.innerHTML = `
        <input class="w3-input" type="text" name="casas[numero][]" placeholder="Número da Casa">
        <input class="w3-input" type="text" name="casas[enfiteutas][]" placeholder="Enfiteutas">
        <input class="w3-input" type="text" name="casas[foro][]" placeholder="Foro">
        <textarea class="w3-input" name="casas[desc][texto][]" placeholder="Descrição"></textarea>
        <div class="refs-entidades-container">
          <label>Entidades:</label>
          <div class="entidade">
            <input class="w3-input" type="text" name="casas[desc][refs][entidades][${casaIndex}][nome][]" placeholder="Nome da Entidade">
            <select class="w3-select" name="casas[desc][refs][entidades][${casaIndex}][tipo][]">
              <option value="pessoa">Pessoa</option>
              <option value="instituição">Instituição</option>
              <option value="empresa">Empresa</option>
              <option value="família">Família</option>
            </select>
          </div>
          <button class="w3-button w3-green" type="button" onclick="addCasaEntidade(${casaIndex}, this)">Adicionar Entidade</button>
        </div>
        <div class="refs-lugares-container">
          <label>Lugares:</label>
          <div class="lugar">
            <input class="w3-input" type="text" name="casas[desc][refs][lugares][${casaIndex}][nome][]" placeholder="Nome do Lugar">
            <input class="w3-input" type="text" name="casas[desc][refs][lugares][${casaIndex}][norm][]" placeholder="Norm (opcional)">
          </div>
          <button class="w3-button w3-green" type="button" onclick="addCasaLugar(${casaIndex}, this)">Adicionar Lugar</button>
        </div>
        <div class="refs-datas-container">
          <label>Datas:</label>
          <div class="data">
            <input class="w3-input" type="text" name="casas[desc][refs][datas][${casaIndex}][]" placeholder="Data">
          </div>
          <button class="w3-button w3-green" type="button" onclick="addCasaData(${casaIndex}, this)">Adicionar Data</button>
        </div>
      `;
      container.appendChild(div);
    }

    function addCasaEntidade(index, button) {
      var container = button.closest('.refs-entidades-container');
      var div = document.createElement('div');
      div.className = 'entidade';
      div.innerHTML = `
        <input class="w3-input" type="text" name="casas[desc][refs][entidades][${index}][nome][]" placeholder="Nome da Entidade">
        <select class="w3-select" name="casas[desc][refs][entidades][${index}][tipo][]">
          <option value="" disabled selected>-- Selecione o Tipo --</option>
          <option value="pessoa">Pessoa</option>
          <option value="instituição">Instituição</option>
          <option value="empresa">Empresa</option>
          <option value="família">Família</option>
        </select>
      `;
      container.appendChild(div);
    }

    function addCasaLugar(index, button) {
      var container = button.closest('.refs-lugares-container');
      var div = document.createElement('div');
      div.className = 'lugar';
      div.innerHTML = `<input class="w3-input" type="text" name="casas[desc][refs][lugares][${index}][nome][]" placeholder="Nome do Lugar"><input class="w3-input" type="text" name="casas[desc][refs][lugares][${index}][norm][]" placeholder="Norm (opcional)">`;
      container.appendChild(div);
    }

    function addCasaData(index, button) {
      var container = button.closest('.refs-datas-container');
      var div = document.createElement('div');
      div.className = 'data';
      div.innerHTML = `<input class="w3-input" type="text" name="casas[desc][refs][datas][${index}][]" placeholder="Data">`;
      container.appendChild(div);
    }